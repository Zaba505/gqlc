language: go

go:
  - '1.12'
  - tip

git:
  depth: 1

env:
  global:
    - GITHUB_TOKEN="8b604d8bbc64af2c0a9fa574aceb06881c9b9544"
  matrix:
    - GO111MODULE=on

script:
  - diff -u <(echo -n) <(gofmt -d .)
  - go vet ./...
  - go test -v -race -coverprofile=coverage.txt -covermode=atomic ./...

after_success:
  - bash <(curl -s https://codecov.io/bash)

deploy:
- provider: script
  skip_cleanup: true
  script: curl -sL https://git.io/goreleaser | bash
  on:
    tags: true
    condition: $TRAVIS_OS_NAME = linux